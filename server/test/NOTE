TODO: (martin) add test server code to this directive